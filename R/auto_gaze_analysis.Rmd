---
title: "Auto-Gaze Analysis"
date: "2/20/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
```

```{r}
library(cowplot)
library(here)
library(magrittr)
library(tidyverse)
theme_set(ggthemes::theme_few())
```

Read data

```{r}
#d <- read_csv(here("data/kyle/results.csv"))
d <- read_csv(here("data/kyle/gold_set_candidates.csv"))
```

Select only gaze-relevant data.

```{r}
d %<>% select(frame:pose_Rz)
```

How long is the video?

```{r}
paste("The input video is", ((max(d$frame, na.rm=t) * 0.033) / 60) %>% round(2), "minutes")
```

What's the success rate?

```{r}
paste("Overall sucess rate is:", d %>% summarise(m = mean(success)) %>% pull(m) %>% round(2))
```

What's the confidence rate?

```{r}
paste("Overall confidence rate is:", 
      d %>% 
        filter(success == 1) %>% 
        summarise(m = mean(confidence)) %>%
        pull(m) %>% 
        round(2))
```

### Diagnostic plots

```{r}
y_min <- min(d$gaze_0_y)
y_max <- max(d$gaze_0_y)
x_min <- min(d$gaze_0_x)
x_max <- max(d$gaze_0_x)

x_dim <- d %>% 
  filter(frame >= 300, frame <= 800, success == 1) %>% 
  ggplot(aes(x = frame, y = gaze_0_x)) + 
  geom_line(col = "darkgrey") + 
  labs(title = "x-coordinates",
       y = "Gaze Coordinate") + 
  lims(y = c(x_min, x_max)) + 
  geom_point(alpha = .3) +
  coord_flip()

y_dim <- d %>% 
  filter(frame >= 300, frame <= 800, success == 1) %>% 
  ggplot(aes(x = frame, y = gaze_0_y)) + 
  geom_line(col = "darkgrey") + 
  labs(title = "y-coordinates",
       y = "Gaze Coordinate") + 
  lims(y = c(y_min, y_max)) + 
  geom_point(alpha = .3)

plot_grid(x_dim, y_dim)
```

## Analyze gold standard

pose_Rx, pose_Ry, pose_Rz Rotation is in radians around X,Y,Z axes with the convention 

$$ R = Rx * Ry * Rz $$ 

This can be seen as pitch (Rx), yaw (Ry), and roll (Rz). The rotation is in world coordinates with camera being the origin.

```{r}
d %<>% rename(pitch = pose_Rx, yaw = pose_Ry, roll = pose_Rz)
```

```{r}
d %>% 
  filter(success == 1, !(gold_code %in% c("away", NA))) %>% 
  ggplot(aes(x = frame, y = gaze_0_x, color = gold_code)) + 
  geom_line(col = "darkgrey") + 
  labs(title = "x-coordinates",
       y = "Gaze Coordinate") + 
  lims(y = c(x_min, x_max)) + 
  geom_point(alpha = .7) +
  coord_flip()
```

Plot x coordinates as a function of yaw

```{r}
d %>% 
  filter(success == 1, !(gold_code %in% c("away", NA))) %>% 
  ggplot(aes(x = gaze_0_x, y = yaw, color = gold_code)) + 
  geom_point() 
```

Y as a function of roll: I predict no relationship

```{r}
GGally::ggpairs(d, columns = c("gaze_0_x", "gaze_0_y", "yaw", "pitch", "roll"))
```
